<html>
<head>
    <title>
        Envelope Budgeting
    </title>
    <link rel ="stylesheet" type = "text/css" href="./styling.css"/>
</head>
<body>
    <div id="header">
        <div id="navbar">
            <h1>Envelope Budget</h1>
            <a href="/">Dashboard</a>
            <a href="/Transactions">Transactions</a>
            <a href="/CategoryTransfers">Category Transfers</a>
        </div>
    </div> <%# //TODO: everything above this can by replaced by a partial %>
    <div class="page">
    <div id="leftbar">
        <h3 id="AB">Account Balances</h3>
    </div>
    <div id="content">
        <table>
            <tr>
              <th>Loading...</th>
            </tr>
          </table>
    </div>
    </div>

    <script type="text/javascript">
        fetch("/DashboardJson") //TODO: Convert these to a promise.all
        .then(response => response.json())
        .then(data => {
            let headings = Object.keys(data[0]);
            let tableHTML = "";
            
            tableHTML += "<tr>\n";
            for(let i = 1; i < headings.length; i++) {
                tableHTML += `<th>${headings[i]}</th>\n`;
            }
            tableHTML += "</tr>\n";

            for(let i = 1; i < data.length; i++) {
                tableHTML += "<tr>\n";
                for(let j = 1; j < headings.length; j++) {
                    rowData = data[i][headings[j]];

                    if(typeof rowData == "number")
                        rowData = rowData.toLocaleString(undefined, { style: 'currency', currency: 'USD' });

                    tableHTML += `<td>${rowData}</td>\n`;
                }
                tableHTML += "</tr>\n";
            }
            document.querySelector("table").innerHTML = tableHTML; 
        });

        fetch("/AccountBalanceJson")
        .then(response => response.json())
        .then(data => {
            let balanceHtml = "";

            data.forEach(account => {
                balanceHtml += `<p>${account.accountName}: $${account.balance}</p>\n`;
            });

            document.querySelector("#AB").insertAdjacentHTML("afterend", balanceHtml)
        });
    </script>
</body> <%# //TODO: everything below this can by replaced by a partial maybe some of the script too %>
<footer>
Kristian Marshall | <a href="mailto:Kristian.Marshall2@student.sl.on.ca">Kristian.Marshall2@student.sl.on.ca</a>
</footer>
</html>

